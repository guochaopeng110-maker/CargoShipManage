# **货船智能机舱管理系统 - 产品需求文档 (PRD)**

## 1. 项目概述

本项目旨在构建一个先进的货船智能机舱管理系统前端应用。该系统通过实时监控设备状态、集中管理告警、查询分析历史数据以及评估设备健康状况，为船员和岸上管理人员提供全面的决策支持，以保障船舶运行安全、提高运维效率。

## 2. 总体设计原则与非功能性需求

### 2.1. UI/UX 设计原则
- **视觉风格统一**: 严格保留项目现有的色调风格、背景和主布局（侧边栏、顶部栏），所有新组件必须与现有UI风格保持一致。
- **响应式布局**: 应用必须在各种终端设备（不同尺寸的PC屏幕、平板电脑等）上提供良好的自适应显示效果。
- **数据可视化**:
    - **丰富直观**: 关键指标的展示必须引入丰富的图表类型（如仪表盘、趋势线、柱状图等），实现具象化、焦点化展示。
    - **图标与动画**: 所有监测点指标必须配备独特的、有业务意义的SVG图标，并附带流畅且视觉冲击力强的动画效果（如指针平滑过渡、状态变化时的脉冲或闪烁）。

### 2.2. 系统架构与数据流
- **分层架构**: 前端必须遵循严格的分层架构。UI组件通过`stores`获取数据，`stores`通过高层`services`与后端交互，`services`内部调用自动生成的`api-client`。**UI组件严禁直接调用API**。
- **统一数据流**: **所有设备数据（无论是历史查询还是实时更新）均视为由后端通过WebSocket推送而来的统一数据流**。`stores`负责管理此数据流的客户端缓存，UI从`stores`响应式地获取数据。

### 2.3. 代码质量与异常处理
- **代码整洁**: 在重构和开发过程中，必须持续关注代码质量，坚决删除不再使用的代码和文件。
- **统一异常处理**: 建立全局统一的错误处理机制，所有在`services`或`stores`中捕获的异常都应交由全局处理器进行标准化处理和用户反馈。

## 3. 信息架构与页面导航

应用导航结构应严格按照以下层级实现，任何页面的增删或层级改动都需经过评审。

- **驾控台 (Dashboard)**
- **监测与报警 (Live Monitoring And Alarm)** (菜单组)
    - 推进系统 (`PropulsionMonitoringPage`)
    - 电池储能 (`BatteryMonitoringPage`)
    - 逆变器 (`InverterMonitoringPage`)
    - 配电系统 (`PowerDistributionPage`)
    - 辅助系统 (`AuxiliarySystemsPage`)
- **告警中心 (Alarm Center)**
- **数据中心 (Data Hub)** (菜单组)
    - 数据查询 (`DataQueryPage`)
    - 历史数据导入 (`DataImportPage`)
- **健康评估 (Health Assessment)** (`HealthAssessmentPage`)
- **系统管理 (System Administration)** (菜单组)
    - 设备管理 (`DeviceManagementPage`)
    - 用户管理 (`UserManagementPage`)
    - 角色与权限 (`RoleManagementPage`)
- **个人账户 (My Account)** (菜单组)
- **范围外功能 (UI保留)**:
    - 视情维护 (Condition-Based Maintenance)
    - 辅助决策 (Decision Support)
    *注：以上两个模块下的所有页面仅保留UI骨架，本期不实现后端功能。*

## 4. 模块功能需求

### 4.1. 实时通信 (WebSocket)
- **连接**: 客户端通过JWT Token认证后连接到`/ws`命名空间。
- **订阅机制**: 客户端可发送`subscribe:equipment`事件订阅指定设备的实时数据，并在离开页面时通过`unsubscribe:equipment`取消订阅。
- **实时数据接收**: 客户端需监听并处理以下由服务端推送的事件：
    - `monitoring:new-data`: 新的设备监测点数据。
    - `alarm:push`: 新的告警或告警状态更新。
    - `alarm:batch`: 批量历史告警。
    - `equipment:health:update`: 设备健康评分更新。

### 4.2. 驾控台 (Dashboard)
- **定位**: 高度聚合的全局态势入口，专注于核心实时状态。
- **功能**:
    - **核心状态监控墙**: 以动画图标和数值展示跨系统的8-12个最关键实时参数。
    - **告警摘要**: 统计各级别告警数量，滚动显示最新紧急告警，并提供“进入告警中心”的快速入口。
    - **健康速览**: 微缩版的全船综合健康评分图，可点击跳转至健康评估页。
    - **快捷操作**: 提供指向常用功能页面的链接。

### 4.3. 监测与报警 (各监控页)
- **定位**: 对单个设备系统进行深度实时监控。
- **布局**:
    - **顶部 - 监控墙**: 以仪表盘/动态图标阵列展示该系统的**所有**监测点指标。
    - **底部 - 告警区**: 专门用于展示与此设备相关的实时告警列表。
- **数据**: 页面所有数据均由WebSocket实时推送。进入页面时订阅设备，离开时取消订阅。
- **监测点定义**: 各系统需展示的监测点，严格遵循《监测点与告警定义》文档。
    - 例如，`电池系统`需展示`总电压`、`SOC荷电状态`等18个监测点。`左/右推进系统`需展示`电机转速`、`轴承温度`等14个监测点。

### 4.4. 告警中心 (Alarm Center)
- **定位**: 集中管理、查询和处理所有告警事件。
- **功能**:
    - **实时/历史切换**: 页面分为“实时告警”和“历史告警”两个标签页。
    - **实时告警**: 列表数据由`alarm:push`事件实时更新，每条告警需提供“确认”操作。
    - **历史告警**: 提供筛选条件（设备、告警等级、日期范围等），通过`GET /api/alarms`分页查询历史告警记录。
    - **告警处理**: 用户可调用`PUT /api/alarms/{id}`接口更新告警状态（如确认、处理中、已解决）。
- **告警定义**: 告警的等级、状态和阈值规则，严格遵循《监测点与告警定义》文档。

### 4.5. 数据中心 (Data Hub)
#### 4.5.1. 数据查询
- **定位**: 高效的原始监测数据查询与导出工具。
- **功能**:
    - **查询条件**: 提供设备选择、监控参数多选和日期范围选择器。
    - **结果展示**: 页面核心为一个带分页功能的数据表格，用于展示查询结果。
    - **数据导出**: 支持将查询结果导出为Excel, CSV, JSON格式。
- **API**: 调用`GET /api/monitoring/data`接口进行分页查询。

#### 4.5.2. 历史数据导入
- **定位**: 支持批量导入历史监测数据。
- **功能**:
    - 提供文件上传界面，支持CSV、Excel等格式。
    - 显示上传进度和后端处理状态。
    - 提供历史导入任务的记录列表。
- **API**: 调用`POST /api/monitoring/data/batch`接口上传数据。

### 4.6. 健康评估 (Health Assessment)
- **定位**: 展示设备健康状态的评估、诊断和趋势预测。
- **布局**: 采用“总-分-细”三段式布局。
    - **顶部 (总)**: 使用大型动态“健康仪表盘”展示全船的综合健康评分。
    - **中部 (分)**: 以“系统健康卡片”网格展示各分系统的独立评分和趋势。
    - **底部 (细)**: 数据表格，用于展示和管理历史健康评估报告。
- **业务逻辑**:
    - 健康评分的计算逻辑遵循《健康报告业务逻辑说明》文档。
    - 报告需包含：综合评分、告警统计、关键指标分析（最大/最小/平均值）、优化建议。
- **API**:
    - `POST /api/reports/health`: 生成健康报告。
    - `GET /api/reports/health`: 查询历史报告列表。
    - `GET /api/reports/health/{id}`: 查询单个报告详情。

### 4.7. 系统管理 (System Administration)
- **定位**: 提供对系统基础数据的增删改查（CRUD）功能。
- **功能**:
    - **设备管理**: 管理设备基础信息。API: `GET, POST, PATCH, DELETE /api/equipment`。
    - **用户管理**: 管理用户信息。API: `GET, POST, PUT, DELETE /api/auth/users`。
    - **角色与权限管理**: 管理用户角色及权限（具体API待定义）。

### 4.8. 认证与授权
- **功能**:
    - 用户注册: `POST /api/auth/register`
    - 用户登录: `POST /api/auth/login`，获取访问令牌。
    - 令牌刷新: `POST /api/auth/refresh`
    - 用户登出: `POST /api/auth/logout`
    - 密码修改: `POST /api/auth/change-password`
    - 个人信息: `GET /api/auth/profile`
- **安全**: 所有需要授权的API请求，必须在请求头中携带有效的Bearer Token。

---