# 提案：重构仪表板页面

## 变更ID
`refactor-dashboard-page`

## 概述

将应用的"着陆页"——`DashboardPage`——重构为一个高信息密度的"指挥中心"，将来自不同系统的最关键实时信息聚合到单一视图中，使用户能够"一目了然"地快速评估全局态势。

## 目标

### 主要目标
- 建立模块化的、基于小组件的仪表板页面模板
- 实现"超级消费者"数据流模式，从多个 Zustand stores 消费数据
- 提供即时、可执行的全局状态洞察
- 成为功能强大且视觉吸引力强的应用入口

### 次要目标
- 产出可复用的小组件（`AlarmSummaryWidget`、`HealthQuickViewWidget` 等）
- 演示如何通过组合多个独立的 Zustand stores 构建复杂、高度聚合的视图
- 确保页面响应式设计，适配不同屏幕尺寸

## 动机

### 当前问题
1. **现有 DashboardPage 功能分散**：虽然已有基础实现，但缺少专门的告警摘要和健康速览小组件
2. **数据源不统一**：部分数据使用模拟数据，未完全从 `alarms-store` 和 `health-store` 获取
3. **信息密度不够**：未能充分展示跨系统的关键指标统计
4. **页面头部冗余**：包含不必要的报表生成器组件

### 预期改进
1. **统一数据流**：完全依赖 `monitoring-store`、`alarms-store`、`health-store` 的实时数据
2. **提高信息密度**：通过小组件化布局，在单一视图中展示更多关键信息
3. **简化页面头部**：移除不必要的报表生成器，保持页面简洁
4. **增强可维护性**：通过模块化小组件，提高代码复用性

## 影响范围

### 新增功能
- **关键指标墙**（Critical Metrics Wall）：展示 8-12 个全船最核心的监测点指标
- **告警摘要小组件**（AlarmSummaryWidget）：按告警等级分类统计，滚动展示最新紧急告警
- **健康速览小组件**（HealthQuickViewWidget）：显示总健康分和等级的迷你仪表盘

### 修改功能
- **DashboardPage 主页面**：重构为基于小组件的模块化布局
- **数据获取逻辑**：从模拟数据迁移到真实 stores
- **页面头部**：移除报表生成器组件，简化布局
- **页面内容**：移除现有的电池系统概览卡片、推进系统状态卡片、活动日志卡片等，仅保留三个核心小组件

### 影响的组件
- `src/components/DashboardPage.tsx`（主要重构）
- 新增小组件：
  - `src/components/widgets/AlarmSummaryWidget.tsx`
  - `src/components/widgets/HealthQuickViewWidget.tsx`
  - `src/components/widgets/CriticalMetricsWall.tsx`

### 依赖的 Stores
- `monitoring-store`（已存在）
- `alarms-store`（已存在）
- `health-store`（已存在）

## 技术方案

### 核心概念

#### 1. 模块化小组件布局（Modular Widget-Based Layout）
页面主体由一个可定制的、响应式的网格构成，网格中填充着各种功能独立的"小组件"（Widget）。

**核心组件**：
1. **关键指标墙**（Critical Metrics Wall）
   - **定位**：跨系统的"超级仪表盘"，展示整船的生命体征
   - **内容**：精心挑选 8-12 个全船最核心、最关键的监测点指标
   - **组件**：使用 `MetricCard` 组件矩阵

2. **告警摘要**（Alarm Summary）
   - **定位**：快速掌握当前的告警态势
   - **内容**：
     - 按告警等级（critical、high、medium、low）分类的实时统计数量
     - 滚动条或短列表，循环展示最新发生的 2-3 条紧急告警
     - 可直接跳转至告警中心的快捷入口

3. **健康速览**（Health Quick-View）
   - **定位**：整船健康状况的紧凑型总结
   - **内容**：迷你版的健康仪表盘（GaugeChart），显示总健康分和等级
   - **交互**：整个组件可点击，跳转至健康评估页面

#### 2. "超级消费者"数据流（Super-Consumer Data Flow）
- `DashboardPage` 是纯粹的"状态消费者"，同时从多个 stores 中获取数据
- **关键指标墙**的数据来源于 `monitoring-store`
- **告警摘要**的数据来源于 `alarms-store`
- **健康速览**的数据来源于 `health-store`
- 页面本身不执行任何数据请求逻辑，完全依赖于已注入到 stores 中的实时数据

### 实现策略
1. **保留现有功能**：保持当前 DashboardPage 的核心功能不变
2. **渐进式重构**：逐步替换模拟数据为真实 store 数据
3. **组件化**：将功能模块提取为独立的小组件
4. **响应式设计**：确保在不同屏幕尺寸下的良好展示

## 风险评估

### 潜在风险
1. **数据依赖性**：依赖 `monitoring-store`、`alarms-store`、`health-store` 的数据完整性
2. **性能问题**：同时从多个 stores 订阅数据可能影响性能
3. **兼容性**：需确保与现有路由和导航系统的兼容性

### 缓解措施
1. **数据校验**：在小组件中添加数据有效性检查和降级处理
2. **性能优化**：使用 React.memo 和 useMemo 优化渲染性能
3. **测试覆盖**：在重构过程中保持功能测试，确保不破坏现有功能

## 验收标准

### 功能验收
- [ ] 所有核心小组件（关键指标墙、告警摘要、健康速览）正常显示
- [ ] 数据完全来自 `monitoring-store`、`alarms-store`、`health-store`
- [ ] 所有导航链接正常工作
- [ ] 响应式布局在不同屏幕尺寸下正常显示
- [ ] 页面头部简洁，不包含报表生成器
- [ ] 页面布局简洁，仅包含三个核心小组件，不包含旧的系统卡片

### 技术验收
- [ ] 代码符合项目规范（React 函数组件、TypeScript 类型定义）
- [ ] 小组件可复用，已导出供其他页面使用
- [ ] 无 TypeScript 编译错误
- [ ] 无明显性能问题（渲染时间、内存占用）

### 视觉验收
- [ ] 符合项目设计风格（暗色主题、玻璃态效果、动画）
- [ ] 信息层级清晰，视觉引导明确
- [ ] 关键信息突出显示，易于识别

## 替代方案

### 方案 A：渐进式重构（推荐）
- 在现有 DashboardPage 基础上逐步重构
- 保留现有功能，减少破坏性变更
- 风险低，但重构周期较长

### 方案 B：全新重写
- 完全重写 DashboardPage
- 可以采用更优的架构设计
- 风险高，可能影响现有功能

**选择方案 A**，因为它更稳妥，能够在保持系统稳定的前提下逐步改进。

## 后续计划

### 短期（本次变更）
1. 完成三个核心小组件的开发（关键指标墙、告警摘要、健康速览）
2. 重构 DashboardPage 主页面
3. 迁移数据源至真实 stores
4. 简化页面头部，移除报表生成器

### 中期（下一阶段）
1. 添加小组件配置功能（用户可自定义显示哪些小组件）
2. 优化性能（虚拟滚动、懒加载）
3. 添加数据刷新控制（手动刷新、自动刷新间隔设置）

### 长期（未来规划）
1. 支持多种布局模式（紧凑、宽松、自定义）
2. 添加小组件拖拽排序功能
3. 支持仪表板模板保存和分享

## 相关文档

- 原始需求文档：`docs/plan/proposal/第三阶段/3.3-确立DashboardPage页面模板.md`
- 项目架构文档：`openspec/project.md`
- 相关变更：
  - `refactor-battery-monitoring-page`（电池监控页面重构，可参考布局模式）
  - `activate-realtime-data-flow`（实时数据流激活，数据源基础）
  - `build-animated-visualization-components`（可视化组件库，可复用组件）
