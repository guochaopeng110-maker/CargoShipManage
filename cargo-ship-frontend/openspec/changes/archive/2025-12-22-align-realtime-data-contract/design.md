# 技术设计: 契约化实时数据链路与系统状态矩阵

## Context
当前实时数据链路在 `MonitoringWall` 模式下存在严重的标识符漂移现象。为了实现 8 个系统的快速、准确展示，必须建立基于标准文档的强制性契约。

## Goals
- 实现前后端统一的语义化契约（标准中文名称）。
- 消除同类指标覆盖问题（Collision Prevention）。
- 首页功能从“数据感知”升级为“状态监控”。

## Decisions

### 1. 契约标识符标准化
**决策**: 使用 `docs/data/monitoring_point_definition.md` 中的 `监测点名称 (UI显示)` 字段作为全链路同步键。
- **发送端**: WebSocket 负载中的 `monitoringPoint` 字段必须填充该中文名。
- **存储端**: 索引格式统一为 `${equipmentId}-${monitoringPoint}`。
- **消费端**: 配置项（如 `MonitoringWall` 数组）的 `id` 后半段使用该中文名。

### 2. 状态判定算法 (System Health Logic)
驾控台卡片状态将基于监控数据流自动计算：
- **在线状态**: 基于 `monitoring-store` 的 `devices` 对象最后更新时间。
- **运行状态**: 匹配监测点名称包含 `运行状态`、`失电`、`跳闸` 等关键字的布尔值。
- **告警严重度**: 实时扫描 `alarms-store` 活跃告警中该 `equipmentId` 的最高等级。

### 3. 图标库全面中文化
`icon-mapping.ts` 的 Key 将全部重写为标准中文名。
- 优点：开发者直接看代码即可获得业务语境。
- 缺点：Key 中包含空格或特殊字符时需注意字符串引用。

## Risks / Trade-offs
- **中文字符风险**: 需要确保文件编码、API 传输及状态管理中的中文字符处理一致，防止乱码（已通过 Vite/TS 配置确认支持）。
- **遗留兼容性**: 此次变更将彻底打破原有的 `metricType` 索引模式，所有监控子页面必须同步更新。

## Migration Plan
1. **更新存取逻辑**: 先修改 Store 的计算键逻辑。
2. **同步配置项**: 批量替换监控页面组件中的配置数组。
3. **切换数据源**: 重写运行中的模拟器以发送新格式数据。
