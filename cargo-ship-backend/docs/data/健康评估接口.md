# 设备时间序列健康评分接口文档

## 1. 接口概述
该接口用于对 **单一设备系统** 在指定时间段内的 **时间序列监测数据** 进行健康评分分析，
基于预定义阈值、权重与时间序列统计规则，输出 **系统级健康评分及各监测点详细评分结果**，
适用于设备健康评估、运维监控与可视化展示。

---

## 2. 接口地址
```
GET /hp/process_data/
```

---

## 3. 请求方式
- HTTP Method：GET  
- Content-Type：application/json  

---

## 4. 请求参数（Query 参数）

| 参数名 | 类型 | 必填 | 说明 |
|------|------|------|------|
| device_id | string | 是 | 设备系统 ID（如 `SYS-BAT-001`、`SYS-BILGE-001`） |
| start_time | string | 是 | 开始时间（格式：`YYYY-MM-DD HH:MM:SS`） |
| end_time | string | 是 | 结束时间（格式：`YYYY-MM-DD HH:MM:SS`） |

### 请求示例
```
GET /hp/process_data/?device_id=SYS-BILGE-001&start_time=2025-12-01 00:00:00&end_time=2025-12-12 00:00:00
```

---

## 5. 返回参数格式说明（重点）

### 顶层返回结构

| 字段名 | 类型 | 说明 |
|------|------|------|
| device_id | string | 设备系统 ID |
| start_time | string | 查询开始时间 |
| end_time | string | 查询结束时间 |
| result | object | 系统评分结果（按系统 ID 组织） |

---

### result 字段结构

```json
result: {
  "<system_id>": {
    "system_name": string,
    "total_score": number,
    "status": string,
    "stat_time_range": string,
    "point_details": object
  }
}
```

---

### point_details 字段结构

```json
point_details: {
  "<monitoring_point_name>": {
    "weight": number,
    "total_score": number,
    "stat_details": object
  }
}
```

---

### stat_details 字段结构

```json
stat_details: {
  "avg_value": number,
  "avg_score": number,
  "max_value": number,
  "max_score": number,
  "exceed_rate": number,
  "exceed_score": number,
  "fluctuation_score": number,
  "data_count": number
}
```

---

## 6. 完整返回示例（舱底水系统）

```json
{
  "device_id": "SYS-BILGE-001",
  "start_time": "2025-12-01 00:00:00",
  "end_time": "2025-12-12 00:00:00",
  "result": {
    "SYS-BILGE-001": {
      "system_name": "舱底水系统",
      "total_score": 22.05,
      "status": "异常",
      "stat_time_range": "3个数据点（假设1分钟/点，共3分钟）",
      "point_details": {
        "1#集水井水位": {
          "weight": 1.2,
          "total_score": 21.0,
          "stat_details": {
            "avg_value": 156.25,
            "avg_score": 52.5,
            "max_value": 220.0,
            "max_score": 0.0,
            "exceed_rate": 1.0,
            "exceed_score": 0.0,
            "fluctuation_score": 0.0,
            "data_count": 3
          }
        }
      }
    }
  }
}
```

---

## 7. 状态说明

| 综合评分区间 | 状态 |
|-------------|------|
| ≥ 90 | 优秀 |
| 70 – 89 | 良好 |
| 60 – 69 | 一般 |
| < 60 | 异常 |

---

## 8. 异常返回说明

### 无数据
```json
{
  "msg": "该时间段无数据",
  "device_id": "SYS-BILGE-001"
}
```

### 参数缺失
```json
{
  "msg": "缺少参数 device_id / start_time / end_time"
}
```

---
