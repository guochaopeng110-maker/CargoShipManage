# 监控数据能力

## ADDED Requirements

### Requirement: 监测点标识
系统 MUST 将每条时序数据记录与特定的业务监测点关联,该监测点在物理指标类型之外唯一标识测量上下文。

#### Scenario: 存储带监测点上下文的电压数据
- **假设** 设备"电池装置系统"有多个电压测量值("总电压"、"单体电压")
- **当** 记录时序数据时使用 `metricType=voltage` 和 `monitoringPoint="总电压"`
- **那么** 系统同时存储物理类型和业务上下文
- **并且** 可以通过监测点精确查询数据

#### Scenario: 查询特定监测点数据
- **假设** 存在设备的各种监测点的时序数据
- **当** 查询特定设备上的"总电压"数据时
- **那么** 仅返回匹配该确切监测点的记录
- **并且** 排除其他电压测量(如"单体电压")

#### Scenario: 区分相同指标类型的测量值
- **假设** 设备有多个温度传感器("轴承温度"、"绕组温度")
- **当** 记录 `metricType=temperature` 但 `monitoringPoint` 值不同的数据时
- **那么** 每个测量值都存储其唯一的业务上下文
- **并且** 告警规则可以针对特定监测点

### Requirement: 监测点验证
系统 MUST 验证监测点已正确定义并与有效设备关联。

#### Scenario: 拒绝未定义的监测点
- **假设** 一个未为设备定义的监测点名称
- **当** 尝试使用该监测点记录时序数据时
- **那么** 系统拒绝数据并返回验证错误
- **并且** 提供该设备有效监测点的指导

#### Scenario: 强制监测点一致性
- **假设** 设备类型定义了有效的监测点
- **当** 为该设备记录数据时
- **那么** 仅接受该设备类型有效的监测点
- **并且** 拒绝无效组合

## ADDED Requirements

### Requirement: 时序数据存储
系统 MUST 存储带时间戳、指标类型、值、质量、来源和监测点信息的时序监控数据。

#### Scenario: 记录完整的监控数据
- **假设** 来自设备的传感器读数
- **当** 数据包括 equipmentId、timestamp、metricType、value、monitoringPoint 以及可选的 unit/quality/source
- **那么** 所有字段存储在 time_series_data 表中
- **并且** 可以检索到包含完整上下文的记录

#### Scenario: 按设备和监测点查询
- **假设** 存在多个设备和监测点的时序数据
- **当** 同时按 equipmentId 和 monitoringPoint 筛选时
- **那么** 仅返回匹配的记录
- **并且** 通过复合索引优化查询性能

#### Scenario: 支持向后兼容
- **假设** 存在没有监测点值的现有时序数据
- **当** 应用模式迁移时
- **那么** 现有记录仍可访问
- **并且** 新记录需要监测点值
