## ADDED Requirements

### Requirement: 监测点数据校验

系统 MUST 在保存时序数据时校验 monitoringPoint 字段是否为该设备的有效监测点。

#### Scenario: 校验有效的监测点

- **假设** 设备 "SYS-BAT-001" 的有效监测点包括 "总电压", "充电电流", "SOC"
- **当** 上报时序数据,equipmentId="SYS-BAT-001", monitoringPoint="总电压", metricType=VOLTAGE, value=650.5
- **那么** 系统验证 "总电压" 是该设备的有效监测点
- **并且** 数据校验通过,成功保存到数据库

#### Scenario: 拒绝无效的监测点

- **假设** 设备 "SYS-BAT-001" 的有效监测点不包括 "油温"
- **当** 上报时序数据,monitoringPoint="油温"
- **那么** 系统检测到该监测点不在元数据表中
- **并且** 返回 400 错误,错误消息为 "监测点 '油温' 不是设备 SYS-BAT-001 的有效监测点"
- **并且** 数据不被保存

#### Scenario: 向后兼容 - 允许空监测点

- **假设** 旧数据或部分数据源不提供 monitoringPoint 字段
- **当** 上报时序数据,monitoringPoint=null 或未提供该字段
- **那么** 系统跳过监测点校验
- **并且** 数据正常保存 (向后兼容模式)
- **并且** 记录警告日志 "数据缺失监测点信息,建议补充以提高数据质量"

#### Scenario: 校验监测点与指标类型的一致性

- **假设** 监测点 "总电压" 在元数据表中定义为 metricType=VOLTAGE
- **当** 上报数据 monitoringPoint="总电压", metricType=TEMPERATURE (类型不匹配)
- **那么** 系统检测到类型不一致
- **并且** 返回 400 错误,错误消息为 "监测点 '总电压' 的指标类型应为 VOLTAGE,但收到 TEMPERATURE"

### Requirement: 单位自动补全

系统 MUST 在时序数据缺失单位时,自动从监测点元数据表中补全单位字段。

#### Scenario: 自动补全缺失的单位

- **假设** 监测点 "总电压" 在元数据表中定义了 unit="V"
- **当** 上报数据 monitoringPoint="总电压", value=650.5, unit=null (未提供单位)
- **那么** 系统自动从元数据表获取单位 "V"
- **并且** 保存时 unit 字段自动填充为 "V"
- **并且** 记录调试日志 "自动补全监测点 '总电压' 的单位: V"

#### Scenario: 保留用户提供的单位

- **假设** 监测点 "总电压" 在元数据表中定义了 unit="V"
- **当** 上报数据明确提供 unit="kV"
- **那么** 系统保留用户提供的单位 "kV"
- **并且** 不进行自动补全
- **并且** 不修改用户原始数据

#### Scenario: 元数据缺失单位时的处理

- **假设** 监测点 "总电压" 在元数据表中 unit=null
- **当** 上报数据也未提供单位
- **那么** 系统保持 unit=null
- **并且** 不进行补全操作
- **并且** 数据正常保存
