## ADDED Requirements

### Requirement: 导入数据监测点校验

系统 MUST 在导入历史数据时校验文件中的监测点名称是否与元数据表中的定义匹配。

#### Scenario: 校验导入文件中的监测点

- **假设** 设备 "SYS-BAT-001" 的有效监测点包括 "总电压", "充电电流", "SOC"
- **当** 导入 Excel 文件,数据行包含 equipmentId="SYS-BAT-001", monitoringPoint="总电压"
- **那么** 系统验证 "总电压" 是该设备的有效监测点
- **并且** 数据通过校验,成功导入

#### Scenario: 拒绝包含无效监测点的数据行

- **假设** 设备 "SYS-BAT-001" 的有效监测点不包括 "油温"
- **当** 导入文件,某行数据 monitoringPoint="油温"
- **那么** 该行数据校验失败
- **并且** 错误列表中记录 "第 N 行: 监测点 '油温' 不是设备 SYS-BAT-001 的有效监测点"
- **并且** 该行数据不被导入

#### Scenario: 批量校验时的性能优化

- **假设** 导入文件包含 1000 条数据,涉及 5 个不同设备
- **当** 执行导入校验时
- **那么** 系统一次性加载这 5 个设备的所有监测点到内存缓存
- **并且** 使用缓存进行批量校验,避免逐行查询数据库
- **并且** 校验性能不受数据量线性影响

#### Scenario: 部分数据成功导入 (容错处理)

- **假设** 导入文件包含 100 条数据,其中 5 条监测点无效
- **当** 执行导入时
- **那么** 95 条有效数据成功导入
- **并且** 5 条无效数据记录在错误列表中
- **并且** 导入记录状态标记为 PARTIAL (部分成功)
- **并且** 返回详细的错误报告供用户修正

### Requirement: 动态生成导入模板

系统 MUST 根据监测点元数据表动态生成数据导入模板,确保模板与当前系统定义实时一致。

#### Scenario: 生成包含监测点的 Excel 模板

- **假设** 用户请求下载设备 "SYS-BAT-001" 的导入模板
- **当** 调用 `GET /api/imports/template/excel?equipmentId=SYS-BAT-001`
- **那么** 系统查询该设备的所有监测点
- **并且** 生成的 Excel 包含 "监测点" 列的下拉选择列表
- **并且** 下拉列表包含该设备的所有有效监测点名称
- **并且** 模板第二行包含示例数据

#### Scenario: 通用模板不限制监测点

- **假设** 用户请求下载通用导入模板 (不指定设备)
- **当** 调用 `GET /api/imports/template/excel` (无 equipmentId 参数)
- **那么** 生成的模板包含 "监测点" 列
- **并且** 该列不设置下拉列表限制 (因为不同设备有不同的监测点)
- **并且** 列标题添加注释 "请填写设备的有效监测点名称"

#### Scenario: CSV 模板包含监测点列

- **假设** 用户请求 CSV 格式模板
- **当** 调用 `GET /api/imports/template/csv`
- **那么** CSV 表头包含 "监测点" 列
- **并且** 第二行包含示例数据,展示正确的填写格式

#### Scenario: 模板与元数据实时同步

- **假设** 管理员为设备 "SYS-BAT-001" 新增了监测点 "绝缘电阻"
- **当** 用户下载该设备的导入模板时
- **那么** 模板的监测点下拉列表包含最新添加的 "绝缘电阻"
- **并且** 无需手动更新模板文件或配置

### Requirement: 导入文档增强

系统 MUST 在导入接口的 Swagger 文档中明确说明监测点字段的重要性和填写规范。

#### Scenario: Swagger 文档说明监测点字段

- **假设** 开发者查看导入接口的 Swagger 文档
- **当** 查看文件上传接口的参数说明时
- **那么** 文档包含监测点字段的详细说明:
  - 字段名称: 监测点
  - 是否必填: 可选,但强烈建议填写
  - 数据类型: 字符串
  - 最大长度: 100 字符
  - 用途: 用于精确匹配阈值规则,确保告警评估的准确性
  - 重要性说明: 不填写可能导致部分告警规则无法触发
  - 示例值: "总电压", "单体最高温度", "主机转速"
- **并且** 包含获取设备有效监测点列表的接口引用

#### Scenario: 错误响应文档包含监测点校验失败

- **假设** Swagger 文档定义了导入接口的错误响应
- **当** 用户查看 400 错误响应示例时
- **那么** 示例包含监测点校验失败的情况:
  ```json
  {
    "code": 400,
    "message": "数据校验失败",
    "data": {
      "errors": [
        {
          "row": 5,
          "field": "monitoringPoint",
          "value": "油温",
          "message": "监测点 '油温' 不是设备 SYS-BAT-001 的有效监测点"
        }
      ]
    }
  }
  ```
